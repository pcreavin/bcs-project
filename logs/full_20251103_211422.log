============================================================
Training Configuration
============================================================
Config: configs/ablation_full.yaml
Device: mps | Batch size: 32 | Epochs: 20
Backbone: efficientnet_b0 | Finetune mode: full
Pretrained: True | Learning rate: 0.0003
Early stopping: True (patience=5, monitor=val_macro_f1)
Output directory: outputs/ablation_full
============================================================

Building datasets...
Train samples: 37496 | Val samples: 8035

Creating model...
Model created: 4,013,953/4,013,953 parameters trainable (100.0%)

Starting training...
------------------------------------------------------------
  Epoch 01 | Step   50 | Loss: 1.9547
  Epoch 01 | Step  100 | Loss: 1.7878
  Epoch 01 | Step  150 | Loss: 1.6543
  Epoch 01 | Step  200 | Loss: 1.2800
  Epoch 01 | Step  250 | Loss: 1.4988
  Epoch 01 | Step  300 | Loss: 1.2202
  Epoch 01 | Step  350 | Loss: 1.2406
  Epoch 01 | Step  400 | Loss: 1.0930
  Epoch 01 | Step  450 | Loss: 1.0306
  Epoch 01 | Step  500 | Loss: 1.1077
  Epoch 01 | Step  550 | Loss: 1.3601
  Epoch 01 | Step  600 | Loss: 1.0609
  Epoch 01 | Step  650 | Loss: 1.3993
  Epoch 01 | Step  700 | Loss: 1.0681
  Epoch 01 | Step  750 | Loss: 1.1750
  Epoch 01 | Step  800 | Loss: 1.0553
  Epoch 01 | Step  850 | Loss: 1.0277
  Epoch 01 | Step  900 | Loss: 1.0614
  Epoch 01 | Step  950 | Loss: 1.0584
  Epoch 01 | Step 1000 | Loss: 0.9283
  Epoch 01 | Step 1050 | Loss: 1.1661
  Epoch 01 | Step 1100 | Loss: 0.9984
  Epoch 01 | Step 1150 | Loss: 1.1285
Epoch 01 | Train Loss: 1.2777 | Val Acc: 0.6661 | Val Macro-F1: 0.6729 | Underweight Recall: 0.6381
  -> New best model saved (Macro-F1: 0.6729)
------------------------------------------------------------
  Epoch 02 | Step   50 | Loss: 0.7478
  Epoch 02 | Step  100 | Loss: 0.6625
  Epoch 02 | Step  150 | Loss: 0.7023
  Epoch 02 | Step  200 | Loss: 0.8811
  Epoch 02 | Step  250 | Loss: 0.7807
  Epoch 02 | Step  300 | Loss: 0.8527
  Epoch 02 | Step  350 | Loss: 0.7470
  Epoch 02 | Step  400 | Loss: 0.9941
  Epoch 02 | Step  450 | Loss: 0.8059
  Epoch 02 | Step  500 | Loss: 0.9155
  Epoch 02 | Step  550 | Loss: 0.9904
  Epoch 02 | Step  600 | Loss: 1.0367
  Epoch 02 | Step  650 | Loss: 0.6080
  Epoch 02 | Step  700 | Loss: 0.7196
  Epoch 02 | Step  750 | Loss: 0.8313
  Epoch 02 | Step  800 | Loss: 0.8485
  Epoch 02 | Step  850 | Loss: 0.8705
  Epoch 02 | Step  900 | Loss: 0.6513
  Epoch 02 | Step  950 | Loss: 0.7787
  Epoch 02 | Step 1000 | Loss: 0.6477
  Epoch 02 | Step 1050 | Loss: 0.7017
  Epoch 02 | Step 1100 | Loss: 0.8038
  Epoch 02 | Step 1150 | Loss: 0.6317
Epoch 02 | Train Loss: 0.7550 | Val Acc: 0.7637 | Val Macro-F1: 0.7714 | Underweight Recall: 0.8301
  -> New best model saved (Macro-F1: 0.7714)
------------------------------------------------------------
  Epoch 03 | Step   50 | Loss: 0.4497
  Epoch 03 | Step  100 | Loss: 0.5060
  Epoch 03 | Step  150 | Loss: 0.4912
  Epoch 03 | Step  200 | Loss: 0.5979
  Epoch 03 | Step  250 | Loss: 0.3901
  Epoch 03 | Step  300 | Loss: 0.4945
  Epoch 03 | Step  350 | Loss: 0.5074
  Epoch 03 | Step  400 | Loss: 0.5547
  Epoch 03 | Step  450 | Loss: 0.5083
  Epoch 03 | Step  500 | Loss: 0.6572
  Epoch 03 | Step  550 | Loss: 0.5501
  Epoch 03 | Step  600 | Loss: 0.5616
  Epoch 03 | Step  650 | Loss: 0.5089
  Epoch 03 | Step  700 | Loss: 0.3701
  Epoch 03 | Step  750 | Loss: 0.5988
  Epoch 03 | Step  800 | Loss: 0.4635
  Epoch 03 | Step  850 | Loss: 0.4348
  Epoch 03 | Step  900 | Loss: 0.5584
  Epoch 03 | Step  950 | Loss: 0.4483
  Epoch 03 | Step 1000 | Loss: 0.7599
  Epoch 03 | Step 1050 | Loss: 0.3828
  Epoch 03 | Step 1100 | Loss: 0.6124
  Epoch 03 | Step 1150 | Loss: 0.3592
Epoch 03 | Train Loss: 0.5088 | Val Acc: 0.8096 | Val Macro-F1: 0.8151 | Underweight Recall: 0.8000
  -> New best model saved (Macro-F1: 0.8151)
------------------------------------------------------------
  Epoch 04 | Step   50 | Loss: 0.3973
  Epoch 04 | Step  100 | Loss: 0.3267
  Epoch 04 | Step  150 | Loss: 0.4610
  Epoch 04 | Step  200 | Loss: 0.3009
  Epoch 04 | Step  250 | Loss: 0.4095
  Epoch 04 | Step  300 | Loss: 0.3787
  Epoch 04 | Step  350 | Loss: 0.3349
  Epoch 04 | Step  400 | Loss: 0.3771
  Epoch 04 | Step  450 | Loss: 0.3344
  Epoch 04 | Step  500 | Loss: 0.3135
  Epoch 04 | Step  550 | Loss: 0.5391
  Epoch 04 | Step  600 | Loss: 0.3602
  Epoch 04 | Step  650 | Loss: 0.4178
  Epoch 04 | Step  700 | Loss: 0.3271
  Epoch 04 | Step  750 | Loss: 0.2994
  Epoch 04 | Step  800 | Loss: 0.3215
  Epoch 04 | Step  850 | Loss: 0.3863
  Epoch 04 | Step  900 | Loss: 0.4699
  Epoch 04 | Step  950 | Loss: 0.3629
  Epoch 04 | Step 1000 | Loss: 0.4192
  Epoch 04 | Step 1050 | Loss: 0.4405
  Epoch 04 | Step 1100 | Loss: 0.5615
  Epoch 04 | Step 1150 | Loss: 0.5402
Epoch 04 | Train Loss: 0.3820 | Val Acc: 0.8254 | Val Macro-F1: 0.8314 | Underweight Recall: 0.8159
  -> New best model saved (Macro-F1: 0.8314)
------------------------------------------------------------
  Epoch 05 | Step   50 | Loss: 0.3802
  Epoch 05 | Step  100 | Loss: 0.3587
  Epoch 05 | Step  150 | Loss: 0.3224
  Epoch 05 | Step  200 | Loss: 0.3092
  Epoch 05 | Step  250 | Loss: 0.3142
  Epoch 05 | Step  300 | Loss: 0.3122
  Epoch 05 | Step  350 | Loss: 0.3011
  Epoch 05 | Step  400 | Loss: 0.2863
  Epoch 05 | Step  450 | Loss: 0.2911
  Epoch 05 | Step  500 | Loss: 0.3185
  Epoch 05 | Step  550 | Loss: 0.2982
  Epoch 05 | Step  600 | Loss: 0.2867
  Epoch 05 | Step  650 | Loss: 0.3552
  Epoch 05 | Step  700 | Loss: 0.4136
  Epoch 05 | Step  750 | Loss: 0.3593
  Epoch 05 | Step  800 | Loss: 0.4169
  Epoch 05 | Step  850 | Loss: 0.3406
  Epoch 05 | Step  900 | Loss: 0.4091
  Epoch 05 | Step  950 | Loss: 0.3352
  Epoch 05 | Step 1000 | Loss: 0.3474
  Epoch 05 | Step 1050 | Loss: 0.4741
  Epoch 05 | Step 1100 | Loss: 0.3490
  Epoch 05 | Step 1150 | Loss: 0.4322
Epoch 05 | Train Loss: 0.3360 | Val Acc: 0.8554 | Val Macro-F1: 0.8602 | Underweight Recall: 0.8628
  -> New best model saved (Macro-F1: 0.8602)
------------------------------------------------------------
  Epoch 06 | Step   50 | Loss: 0.2802
  Epoch 06 | Step  100 | Loss: 0.2767
  Epoch 06 | Step  150 | Loss: 0.3218
  Epoch 06 | Step  200 | Loss: 0.2955
  Epoch 06 | Step  250 | Loss: 0.3680
  Epoch 06 | Step  300 | Loss: 0.2815
  Epoch 06 | Step  350 | Loss: 0.3315
  Epoch 06 | Step  400 | Loss: 0.3160
  Epoch 06 | Step  450 | Loss: 0.3040
  Epoch 06 | Step  500 | Loss: 0.2892
  Epoch 06 | Step  550 | Loss: 0.3003
  Epoch 06 | Step  600 | Loss: 0.2807
  Epoch 06 | Step  650 | Loss: 0.2702
  Epoch 06 | Step  700 | Loss: 0.2782
  Epoch 06 | Step  750 | Loss: 0.3052
  Epoch 06 | Step  800 | Loss: 0.3170
  Epoch 06 | Step  850 | Loss: 0.3307
  Epoch 06 | Step  900 | Loss: 0.3087
  Epoch 06 | Step  950 | Loss: 0.3403
  Epoch 06 | Step 1000 | Loss: 0.3182
  Epoch 06 | Step 1050 | Loss: 0.2996
  Epoch 06 | Step 1100 | Loss: 0.3161
  Epoch 06 | Step 1150 | Loss: 0.3714
Epoch 06 | Train Loss: 0.3161 | Val Acc: 0.8604 | Val Macro-F1: 0.8626 | Underweight Recall: 0.8212
  -> New best model saved (Macro-F1: 0.8626)
------------------------------------------------------------
  Epoch 07 | Step   50 | Loss: 0.3002
  Epoch 07 | Step  100 | Loss: 0.3152
  Epoch 07 | Step  150 | Loss: 0.3507
  Epoch 07 | Step  200 | Loss: 0.3343
  Epoch 07 | Step  250 | Loss: 0.3514
  Epoch 07 | Step  300 | Loss: 0.4527
  Epoch 07 | Step  350 | Loss: 0.3108
  Epoch 07 | Step  400 | Loss: 0.3644
  Epoch 07 | Step  450 | Loss: 0.3201
  Epoch 07 | Step  500 | Loss: 0.2844
  Epoch 07 | Step  550 | Loss: 0.2946
  Epoch 07 | Step  600 | Loss: 0.2919
  Epoch 07 | Step  650 | Loss: 0.3388
  Epoch 07 | Step  700 | Loss: 0.2982
  Epoch 07 | Step  750 | Loss: 0.3197
  Epoch 07 | Step  800 | Loss: 0.2780
  Epoch 07 | Step  850 | Loss: 0.3014
  Epoch 07 | Step  900 | Loss: 0.3418
  Epoch 07 | Step  950 | Loss: 0.3219
  Epoch 07 | Step 1000 | Loss: 0.3213
  Epoch 07 | Step 1050 | Loss: 0.3298
  Epoch 07 | Step 1100 | Loss: 0.3838
  Epoch 07 | Step 1150 | Loss: 0.3768
Epoch 07 | Train Loss: 0.3226 | Val Acc: 0.8516 | Val Macro-F1: 0.8556 | Underweight Recall: 0.8602
------------------------------------------------------------
  Epoch 08 | Step   50 | Loss: 0.3505
  Epoch 08 | Step  100 | Loss: 0.3365
  Epoch 08 | Step  150 | Loss: 0.3629
  Epoch 08 | Step  200 | Loss: 0.3670
  Epoch 08 | Step  250 | Loss: 0.2797
  Epoch 08 | Step  300 | Loss: 0.3140
  Epoch 08 | Step  350 | Loss: 0.2721
  Epoch 08 | Step  400 | Loss: 0.2819
  Epoch 08 | Step  450 | Loss: 0.2695
  Epoch 08 | Step  500 | Loss: 0.2811
  Epoch 08 | Step  550 | Loss: 0.2639
  Epoch 08 | Step  600 | Loss: 0.3573
  Epoch 08 | Step  650 | Loss: 0.3232
  Epoch 08 | Step  700 | Loss: 0.2619
  Epoch 08 | Step  750 | Loss: 0.2671
  Epoch 08 | Step  800 | Loss: 0.2874
  Epoch 08 | Step  850 | Loss: 0.3072
  Epoch 08 | Step  900 | Loss: 0.2972
  Epoch 08 | Step  950 | Loss: 0.3118
  Epoch 08 | Step 1000 | Loss: 0.2913
  Epoch 08 | Step 1050 | Loss: 0.3002
  Epoch 08 | Step 1100 | Loss: 0.3157
  Epoch 08 | Step 1150 | Loss: 0.2521
Epoch 08 | Train Loss: 0.2945 | Val Acc: 0.8819 | Val Macro-F1: 0.8854 | Underweight Recall: 0.8442
  -> New best model saved (Macro-F1: 0.8854)
------------------------------------------------------------
  Epoch 09 | Step   50 | Loss: 0.2596
  Epoch 09 | Step  100 | Loss: 0.2943
  Epoch 09 | Step  150 | Loss: 0.2804
  Epoch 09 | Step  200 | Loss: 0.2714
  Epoch 09 | Step  250 | Loss: 0.2623
  Epoch 09 | Step  300 | Loss: 0.2483
  Epoch 09 | Step  350 | Loss: 0.3430
  Epoch 09 | Step  400 | Loss: 0.3015
  Epoch 09 | Step  450 | Loss: 0.2601
  Epoch 09 | Step  500 | Loss: 0.2707
  Epoch 09 | Step  550 | Loss: 0.2697
  Epoch 09 | Step  600 | Loss: 0.2887
  Epoch 09 | Step  650 | Loss: 0.2752
  Epoch 09 | Step  700 | Loss: 0.3047
  Epoch 09 | Step  750 | Loss: 0.2723
  Epoch 09 | Step  800 | Loss: 0.2788
  Epoch 09 | Step  850 | Loss: 0.2634
  Epoch 09 | Step  900 | Loss: 0.3254
  Epoch 09 | Step  950 | Loss: 0.2972
  Epoch 09 | Step 1000 | Loss: 0.3577
  Epoch 09 | Step 1050 | Loss: 0.2808
  Epoch 09 | Step 1100 | Loss: 0.2797
  Epoch 09 | Step 1150 | Loss: 0.3071
Epoch 09 | Train Loss: 0.2810 | Val Acc: 0.8887 | Val Macro-F1: 0.8910 | Underweight Recall: 0.8796
  -> New best model saved (Macro-F1: 0.8910)
------------------------------------------------------------
  Epoch 10 | Step   50 | Loss: 0.3075
  Epoch 10 | Step  100 | Loss: 0.2948
  Epoch 10 | Step  150 | Loss: 0.2522
  Epoch 10 | Step  200 | Loss: 0.2585
  Epoch 10 | Step  250 | Loss: 0.2650
  Epoch 10 | Step  300 | Loss: 0.4097
  Epoch 10 | Step  350 | Loss: 0.2659
  Epoch 10 | Step  400 | Loss: 0.2677
  Epoch 10 | Step  450 | Loss: 0.2525
  Epoch 10 | Step  500 | Loss: 0.2994
  Epoch 10 | Step  550 | Loss: 0.2721
  Epoch 10 | Step  600 | Loss: 0.2619
  Epoch 10 | Step  650 | Loss: 0.3265
  Epoch 10 | Step  700 | Loss: 0.3234
  Epoch 10 | Step  750 | Loss: 0.2730
  Epoch 10 | Step  800 | Loss: 0.2795
  Epoch 10 | Step  850 | Loss: 0.2934
  Epoch 10 | Step  900 | Loss: 0.3083
  Epoch 10 | Step  950 | Loss: 0.3594
  Epoch 10 | Step 1000 | Loss: 0.2919
  Epoch 10 | Step 1050 | Loss: 0.2870
  Epoch 10 | Step 1100 | Loss: 0.3961
  Epoch 10 | Step 1150 | Loss: 0.4865
Epoch 10 | Train Loss: 0.2895 | Val Acc: 0.8564 | Val Macro-F1: 0.8578 | Underweight Recall: 0.8681
------------------------------------------------------------
  Epoch 11 | Step   50 | Loss: 0.2827
  Epoch 11 | Step  100 | Loss: 0.2938
  Epoch 11 | Step  150 | Loss: 0.3954
  Epoch 11 | Step  200 | Loss: 0.3612
  Epoch 11 | Step  250 | Loss: 0.3029
  Epoch 11 | Step  300 | Loss: 0.3041
  Epoch 11 | Step  350 | Loss: 0.2794
  Epoch 11 | Step  400 | Loss: 0.2638
  Epoch 11 | Step  450 | Loss: 0.3203
  Epoch 11 | Step  500 | Loss: 0.3603
  Epoch 11 | Step  550 | Loss: 0.3626
  Epoch 11 | Step  600 | Loss: 0.2701
  Epoch 11 | Step  650 | Loss: 0.2791
  Epoch 11 | Step  700 | Loss: 0.3249
  Epoch 11 | Step  750 | Loss: 0.2928
  Epoch 11 | Step  800 | Loss: 0.3308
  Epoch 11 | Step  850 | Loss: 0.2727
  Epoch 11 | Step  900 | Loss: 0.2761
  Epoch 11 | Step  950 | Loss: 0.3022
  Epoch 11 | Step 1000 | Loss: 0.4684
  Epoch 11 | Step 1050 | Loss: 0.2520
  Epoch 11 | Step 1100 | Loss: 0.2677
  Epoch 11 | Step 1150 | Loss: 0.2761
Epoch 11 | Train Loss: 0.3034 | Val Acc: 0.9093 | Val Macro-F1: 0.9129 | Underweight Recall: 0.8823
  -> New best model saved (Macro-F1: 0.9129)
------------------------------------------------------------
  Epoch 12 | Step   50 | Loss: 0.2631
  Epoch 12 | Step  100 | Loss: 0.2633
  Epoch 12 | Step  150 | Loss: 0.2525
  Epoch 12 | Step  200 | Loss: 0.2617
  Epoch 12 | Step  250 | Loss: 0.2672
  Epoch 12 | Step  300 | Loss: 0.2431
  Epoch 12 | Step  350 | Loss: 0.2596
  Epoch 12 | Step  400 | Loss: 0.2515
  Epoch 12 | Step  450 | Loss: 0.2748
  Epoch 12 | Step  500 | Loss: 0.2458
  Epoch 12 | Step  550 | Loss: 0.2572
  Epoch 12 | Step  600 | Loss: 0.2598
  Epoch 12 | Step  650 | Loss: 0.2459
  Epoch 12 | Step  700 | Loss: 0.2528
  Epoch 12 | Step  750 | Loss: 0.2598
  Epoch 12 | Step  800 | Loss: 0.2548
  Epoch 12 | Step  850 | Loss: 0.2509
  Epoch 12 | Step  900 | Loss: 0.2531
  Epoch 12 | Step  950 | Loss: 0.2503
  Epoch 12 | Step 1000 | Loss: 0.2476
  Epoch 12 | Step 1050 | Loss: 0.2636
  Epoch 12 | Step 1100 | Loss: 0.2448
  Epoch 12 | Step 1150 | Loss: 0.2674
Epoch 12 | Train Loss: 0.2555 | Val Acc: 0.9216 | Val Macro-F1: 0.9247 | Underweight Recall: 0.8973
  -> New best model saved (Macro-F1: 0.9247)
------------------------------------------------------------
  Epoch 13 | Step   50 | Loss: 0.2446
  Epoch 13 | Step  100 | Loss: 0.2429
  Epoch 13 | Step  150 | Loss: 0.2423
  Epoch 13 | Step  200 | Loss: 0.2453
  Epoch 13 | Step  250 | Loss: 0.2675
  Epoch 13 | Step  300 | Loss: 0.2517
  Epoch 13 | Step  350 | Loss: 0.2469
  Epoch 13 | Step  400 | Loss: 0.2454
  Epoch 13 | Step  450 | Loss: 0.2377
  Epoch 13 | Step  500 | Loss: 0.2478
  Epoch 13 | Step  550 | Loss: 0.2418
  Epoch 13 | Step  600 | Loss: 0.2428
  Epoch 13 | Step  650 | Loss: 0.2443
  Epoch 13 | Step  700 | Loss: 0.2436
  Epoch 13 | Step  750 | Loss: 0.2433
  Epoch 13 | Step  800 | Loss: 0.2544
  Epoch 13 | Step  850 | Loss: 0.2541
  Epoch 13 | Step  900 | Loss: 0.2558
  Epoch 13 | Step  950 | Loss: 0.2522
  Epoch 13 | Step 1000 | Loss: 0.2763
  Epoch 13 | Step 1050 | Loss: 0.3181
  Epoch 13 | Step 1100 | Loss: 0.2531
  Epoch 13 | Step 1150 | Loss: 0.2646
Epoch 13 | Train Loss: 0.2540 | Val Acc: 0.8952 | Val Macro-F1: 0.8969 | Underweight Recall: 0.8894
------------------------------------------------------------
  Epoch 14 | Step   50 | Loss: 0.3005
  Epoch 14 | Step  100 | Loss: 0.3517
  Epoch 14 | Step  150 | Loss: 0.2940
  Epoch 14 | Step  200 | Loss: 0.3470
  Epoch 14 | Step  250 | Loss: 0.4882
  Epoch 14 | Step  300 | Loss: 0.3694
  Epoch 14 | Step  350 | Loss: 0.4703
  Epoch 14 | Step  400 | Loss: 0.3885
  Epoch 14 | Step  450 | Loss: 0.3303
  Epoch 14 | Step  500 | Loss: 0.3242
  Epoch 14 | Step  550 | Loss: 0.2973
  Epoch 14 | Step  600 | Loss: 0.2955
  Epoch 14 | Step  650 | Loss: 0.3000
  Epoch 14 | Step  700 | Loss: 0.2984
  Epoch 14 | Step  750 | Loss: 0.2725
  Epoch 14 | Step  800 | Loss: 0.2509
  Epoch 14 | Step  850 | Loss: 0.2943
  Epoch 14 | Step  900 | Loss: 0.2657
  Epoch 14 | Step  950 | Loss: 0.3005
  Epoch 14 | Step 1000 | Loss: 0.2528
  Epoch 14 | Step 1050 | Loss: 0.2741
  Epoch 14 | Step 1100 | Loss: 0.2925
  Epoch 14 | Step 1150 | Loss: 0.2751
Epoch 14 | Train Loss: 0.3185 | Val Acc: 0.9093 | Val Macro-F1: 0.9118 | Underweight Recall: 0.8903
------------------------------------------------------------
  Epoch 15 | Step   50 | Loss: 0.2507
  Epoch 15 | Step  100 | Loss: 0.2832
  Epoch 15 | Step  150 | Loss: 0.3075
  Epoch 15 | Step  200 | Loss: 0.2443
  Epoch 15 | Step  250 | Loss: 0.2750
  Epoch 15 | Step  300 | Loss: 0.2396
  Epoch 15 | Step  350 | Loss: 0.2739
  Epoch 15 | Step  400 | Loss: 0.2818
  Epoch 15 | Step  450 | Loss: 0.2528
  Epoch 15 | Step  500 | Loss: 0.2427
  Epoch 15 | Step  550 | Loss: 0.2402
  Epoch 15 | Step  600 | Loss: 0.2411
  Epoch 15 | Step  650 | Loss: 0.2413
  Epoch 15 | Step  700 | Loss: 0.2448
  Epoch 15 | Step  750 | Loss: 0.2566
  Epoch 15 | Step  800 | Loss: 0.2396
  Epoch 15 | Step  850 | Loss: 0.2421
  Epoch 15 | Step  900 | Loss: 0.2473
  Epoch 15 | Step  950 | Loss: 0.2529
  Epoch 15 | Step 1000 | Loss: 0.2605
  Epoch 15 | Step 1050 | Loss: 0.2854
  Epoch 15 | Step 1100 | Loss: 0.2522
  Epoch 15 | Step 1150 | Loss: 0.2449
Epoch 15 | Train Loss: 0.2512 | Val Acc: 0.9226 | Val Macro-F1: 0.9253 | Underweight Recall: 0.9159
  -> New best model saved (Macro-F1: 0.9253)
------------------------------------------------------------
  Epoch 16 | Step   50 | Loss: 0.2407
  Epoch 16 | Step  100 | Loss: 0.2387
  Epoch 16 | Step  150 | Loss: 0.2448
  Epoch 16 | Step  200 | Loss: 0.2388
  Epoch 16 | Step  250 | Loss: 0.2507
  Epoch 16 | Step  300 | Loss: 0.2403
  Epoch 16 | Step  350 | Loss: 0.2444
  Epoch 16 | Step  400 | Loss: 0.2380
  Epoch 16 | Step  450 | Loss: 0.2396
  Epoch 16 | Step  500 | Loss: 0.2510
  Epoch 16 | Step  550 | Loss: 0.2516
  Epoch 16 | Step  600 | Loss: 0.2430
  Epoch 16 | Step  650 | Loss: 0.2386
  Epoch 16 | Step  700 | Loss: 0.2736
  Epoch 16 | Step  750 | Loss: 0.2470
  Epoch 16 | Step  800 | Loss: 0.2388
  Epoch 16 | Step  850 | Loss: 0.2628
  Epoch 16 | Step  900 | Loss: 0.2651
  Epoch 16 | Step  950 | Loss: 0.2487
  Epoch 16 | Step 1000 | Loss: 0.2718
  Epoch 16 | Step 1050 | Loss: 0.3120
  Epoch 16 | Step 1100 | Loss: 0.3299
  Epoch 16 | Step 1150 | Loss: 0.3568
Epoch 16 | Train Loss: 0.2570 | Val Acc: 0.8569 | Val Macro-F1: 0.8617 | Underweight Recall: 0.8204
------------------------------------------------------------
  Epoch 17 | Step   50 | Loss: 0.2649
  Epoch 17 | Step  100 | Loss: 0.3434
  Epoch 17 | Step  150 | Loss: 0.2744
  Epoch 17 | Step  200 | Loss: 0.2608
  Epoch 17 | Step  250 | Loss: 0.3154
  Epoch 17 | Step  300 | Loss: 0.2617
  Epoch 17 | Step  350 | Loss: 0.2856
  Epoch 17 | Step  400 | Loss: 0.2835
  Epoch 17 | Step  450 | Loss: 0.2524
  Epoch 17 | Step  500 | Loss: 0.2543
  Epoch 17 | Step  550 | Loss: 0.2959
  Epoch 17 | Step  600 | Loss: 0.2485
  Epoch 17 | Step  650 | Loss: 0.2900
  Epoch 17 | Step  700 | Loss: 0.3573
  Epoch 17 | Step  750 | Loss: 0.2716
  Epoch 17 | Step  800 | Loss: 0.2570
  Epoch 17 | Step  850 | Loss: 0.2527
  Epoch 17 | Step  900 | Loss: 0.2603
  Epoch 17 | Step  950 | Loss: 0.2549
  Epoch 17 | Step 1000 | Loss: 0.2567
  Epoch 17 | Step 1050 | Loss: 0.2779
  Epoch 17 | Step 1100 | Loss: 0.2735
  Epoch 17 | Step 1150 | Loss: 0.2518
Epoch 17 | Train Loss: 0.2828 | Val Acc: 0.9104 | Val Macro-F1: 0.9134 | Underweight Recall: 0.8779
------------------------------------------------------------
  Epoch 18 | Step   50 | Loss: 0.2536
  Epoch 18 | Step  100 | Loss: 0.2976
  Epoch 18 | Step  150 | Loss: 0.2430
  Epoch 18 | Step  200 | Loss: 0.2487
  Epoch 18 | Step  250 | Loss: 0.2383
  Epoch 18 | Step  300 | Loss: 0.2654
  Epoch 18 | Step  350 | Loss: 0.2464
  Epoch 18 | Step  400 | Loss: 0.2482
  Epoch 18 | Step  450 | Loss: 0.2568
  Epoch 18 | Step  500 | Loss: 0.2736
  Epoch 18 | Step  550 | Loss: 0.2978
  Epoch 18 | Step  600 | Loss: 0.2516
  Epoch 18 | Step  650 | Loss: 0.2412
  Epoch 18 | Step  700 | Loss: 0.2518
  Epoch 18 | Step  750 | Loss: 0.2471
  Epoch 18 | Step  800 | Loss: 0.2465
  Epoch 18 | Step  850 | Loss: 0.2430
  Epoch 18 | Step  900 | Loss: 0.2410
  Epoch 18 | Step  950 | Loss: 0.2499
  Epoch 18 | Step 1000 | Loss: 0.2421
  Epoch 18 | Step 1050 | Loss: 0.2512
  Epoch 18 | Step 1100 | Loss: 0.2545
  Epoch 18 | Step 1150 | Loss: 0.2925
Epoch 18 | Train Loss: 0.2550 | Val Acc: 0.8880 | Val Macro-F1: 0.8911 | Underweight Recall: 0.8841
------------------------------------------------------------
  Epoch 19 | Step   50 | Loss: 0.2662
  Epoch 19 | Step  100 | Loss: 0.2726
  Epoch 19 | Step  150 | Loss: 0.2671
  Epoch 19 | Step  200 | Loss: 0.2552
  Epoch 19 | Step  250 | Loss: 0.3083
  Epoch 19 | Step  300 | Loss: 0.2955
  Epoch 19 | Step  350 | Loss: 0.3118
  Epoch 19 | Step  400 | Loss: 0.2443
  Epoch 19 | Step  450 | Loss: 0.2471
  Epoch 19 | Step  500 | Loss: 0.2782
  Epoch 19 | Step  550 | Loss: 0.2484
  Epoch 19 | Step  600 | Loss: 0.2410
  Epoch 19 | Step  650 | Loss: 0.2576
  Epoch 19 | Step  700 | Loss: 0.2615
  Epoch 19 | Step  750 | Loss: 0.2733
  Epoch 19 | Step  800 | Loss: 0.2612
  Epoch 19 | Step  850 | Loss: 0.2644
  Epoch 19 | Step  900 | Loss: 0.2486
  Epoch 19 | Step  950 | Loss: 0.2534
  Epoch 19 | Step 1000 | Loss: 0.2662
  Epoch 19 | Step 1050 | Loss: 0.2645
  Epoch 19 | Step 1100 | Loss: 0.4544
  Epoch 19 | Step 1150 | Loss: 0.2598
Epoch 19 | Train Loss: 0.2719 | Val Acc: 0.8962 | Val Macro-F1: 0.9004 | Underweight Recall: 0.8628
------------------------------------------------------------
  Epoch 20 | Step   50 | Loss: 0.2409
  Epoch 20 | Step  100 | Loss: 0.2364
  Epoch 20 | Step  150 | Loss: 0.2440
  Epoch 20 | Step  200 | Loss: 0.2356
  Epoch 20 | Step  250 | Loss: 0.2405
  Epoch 20 | Step  300 | Loss: 0.2481
  Epoch 20 | Step  350 | Loss: 0.2680
  Epoch 20 | Step  400 | Loss: 0.2462
  Epoch 20 | Step  450 | Loss: 0.2461
  Epoch 20 | Step  500 | Loss: 0.2608
  Epoch 20 | Step  550 | Loss: 0.2383
  Epoch 20 | Step  600 | Loss: 0.2418
  Epoch 20 | Step  650 | Loss: 0.2391
  Epoch 20 | Step  700 | Loss: 0.2503
  Epoch 20 | Step  750 | Loss: 0.2776
  Epoch 20 | Step  800 | Loss: 0.2393
  Epoch 20 | Step  850 | Loss: 0.2401
  Epoch 20 | Step  900 | Loss: 0.2656
  Epoch 20 | Step  950 | Loss: 0.2763
  Epoch 20 | Step 1000 | Loss: 0.2436
  Epoch 20 | Step 1050 | Loss: 0.2385
  Epoch 20 | Step 1100 | Loss: 0.2780
  Epoch 20 | Step 1150 | Loss: 0.2459
Epoch 20 | Train Loss: 0.2553 | Val Acc: 0.8900 | Val Macro-F1: 0.8920 | Underweight Recall: 0.8823

Early stopping triggered at epoch 20
Best val_macro_f1: 0.9253

Final evaluation on best model...
Saved confusion matrix to outputs/ablation_full/confusion_matrix.png
Saved metrics to outputs/ablation_full/metrics.json

============================================================
Training Complete
============================================================
Best Val Accuracy: 0.9226
Best Val Macro-F1: 0.9253
Best Underweight Recall: 0.9159

Artifacts saved to: outputs/ablation_full
============================================================
